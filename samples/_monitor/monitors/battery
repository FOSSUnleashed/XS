#! /usr/bin/env xs

. $HERE/common

BAT = /sys/class/power_supply/BAT
AC = /sys/class/power_supply/AC
LOW = 10

ls $BAT^* >/dev/null >[2=1] || exit

while true {
	sleep 60
	if {{access -d $AC} && {~ `{cat $AC/online} 1}} {
		# We're on line power at the moment
	} else {
		for d $BAT? {
			if {{~ `{cat $d/present} 1} \
					&& {`{cat $d/capacity} :gt $LOW}} {
				# Charge level is OK
			} else {
				announce Low battery!
			}
		}
	}
}
